{"version":3,"sources":["../../src/Bot/Handler.js"],"names":["baseURL","process","env","BASE_URL","batch_list","a","b","c","d","e","command_prefix","messageToCommandValidate","chat","content_command","slice","length","content_args","map","item","trim","console","log","handleCommand","commandList","content_prefix","Object","keys","includes","userQueue","Bot","queue","increment","userId","props","event","source","decrement","Handler","Worker","whitelist","Features","Access","type","user","room","message","handleText","handleImage","handleVideo","handleAudio","handleLocation","handleSticker","Error","JSON","stringify","client","getProfile","joined","members","then","profile","replyText","displayName","data","postback","params","beacon","hwid","replyToken","FEPList","StoreAdvance","Basic","Template","add","upd","update","rem","remove","view","rstore","reset_store","pstore","pre_store","bstore","backup_store","admin","help","button","confirm","bifest","greet","say","response","DialogFlow","request","chat_splitted","text","split","getContent","contentProvider","downloadPath","path","join","__dirname","id","previewPath","downloadContent","cp","execSync","originalContentUrl","basename","previewImageUrl","catch","err","Promise","resolve","replyMessage","title","address","latitude","longitude"],"mappings":"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","file":"Handler.js","sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\nimport cp from \"child_process\";\nimport { Bot } from \"./internal\";\n\n// base URL for webhook server\nexport const baseURL = process.env.BASE_URL;\n\nexport const batch_list = {\n  a: \"22 - 27 JULI 2019\",\n  b: \"29 JULI - 3 AGUSTUS 2019\",\n  c: \"5 - 10 AGUSTUS 2019\",\n  d: \"19 - 24 AGUSTUS 2019\",\n  e: \"26 - 03 SEPTEMBER 2019\"\n};\n\nexport const command_prefix = \"/\";\n\nconst messageToCommandValidate = chat => {\n  const content_command = chat[0].slice(1, chat[0].length);\n  const content_args = chat.slice(1, chat.length).map(item => item.trim());\n\n  console.log(content_command, content_args);\n\n  return { content_command, content_args };\n};\n\nconst handleCommand = (commandList, chat) => {\n  const content_prefix = chat[0][0];\n  if (content_prefix === command_prefix) {\n    const { content_command, content_args } = messageToCommandValidate(chat);\n    if (Object.keys(commandList).includes(content_command)) {\n      if (commandList[content_command].length >= 1) {\n        commandList[content_command](content_args);\n      } else {\n        commandList[content_command]();\n      }\n    }\n  }\n};\n\nconst userQueue = Bot => {\n  const queue = {};\n\n  const increment = () => {\n    const { userId } = Bot.props.event.source;\n    if (!queue[userId]) {\n      queue[userId] = 0;\n    }\n    queue[userId] += 1;\n  };\n\n  const decrement = () => {\n    const { userId } = Bot.props.event.source;\n    if (!queue[userId]) {\n      queue[userId] = 0;\n    }\n    if (queue[userId] >= 1) {\n      queue[userId] -= 1;\n    }\n  };\n\n  return {\n    increment,\n    decrement\n  };\n};\n\nexport const Handler = event => {\n  console.log(event);\n\n  const Worker = new Bot({ event });\n  // Worker.log()\n\n  const whitelist = Worker.Features.Access.whitelist();\n  console.log(whitelist);\n  const type = whitelist.user || whitelist.room ? event.type : null;\n\n  switch (type) {\n    case \"message\":\n      const { message } = event;\n      switch (message.type) {\n        case \"text\":\n          return handleText(Worker);\n        case \"image\":\n          return handleImage(Worker);\n        case \"video\":\n          return handleVideo(Worker);\n        case \"audio\":\n          return handleAudio(Worker);\n        case \"location\":\n          return handleLocation(Worker);\n        case \"sticker\":\n          return handleSticker(Worker);\n        default:\n          throw new Error(`Unknown message: ${JSON.stringify(message)}`);\n      }\n\n    case \"memberJoined\":\n      return Worker.client\n        .getProfile(event.joined.members[0].userId)\n        .then(profile => {\n          Worker.replyText(\n            `Welcome ${profile.displayName}! Jangan lupa cek notes di group ya!`\n          );\n        });\n\n    case \"follow\":\n      return Worker.replyText(\"Got followed event\");\n\n    case \"unfollow\":\n      return console.log(`Unfollowed this bot: ${JSON.stringify(event)}`);\n\n    case \"join\":\n      return Worker.replyText(`Joined ${event.source.type}`);\n\n    case \"leave\":\n      return console.log(`Left: ${JSON.stringify(event)}`);\n\n    case \"postback\":\n      let { data } = event.postback;\n      if (data === \"DATE\" || data === \"TIME\" || data === \"DATETIME\") {\n        data += `(${JSON.stringify(event.postback.params)})`;\n      }\n      return Worker.replyText(`Got postback: ${data}`);\n\n    case \"beacon\":\n      return Worker.replyText(`Got beacon: ${event.beacon.hwid}`);\n\n    default:\n      throw new Error(`Unknown event: ${JSON.stringify(event)}`);\n  }\n};\n\nconst handleText = async Bot => {\n  const { message, replyToken, source } = Bot.props.event;\n  const { FEPList, StoreAdvance, Basic, Template } = Bot.Features;\n\n  const commandList = {\n    add: FEPList.add,\n    upd: FEPList.update,\n    rem: FEPList.remove,\n    view: FEPList.view,\n    rstore: StoreAdvance.reset_store,\n    pstore: StoreAdvance.pre_store,\n    bstore: StoreAdvance.backup_store,\n    \"]]\": Basic.admin,\n    help: Basic.help,\n    button: Template.button,\n    profile: Basic.profile,\n    confirm: Template.confirm,\n    bifest: Template.bifest,\n    greet: Basic.greet,\n    say: Basic.say\n  };\n\n  // The text query request.\n\n  const response = await Bot.DialogFlow.request(message);\n\n  Bot.replyText(response);\n\n  const chat_splitted = message.text.split(\" \");\n  handleCommand(commandList, chat_splitted);\n};\n\nconst handleImage = async Bot => {\n  const { message, replyToken } = Bot.props.event;\n  let getContent;\n\n  if (message.contentProvider.type === \"line\") {\n    const downloadPath = path.join(\n      __dirname,\n      \"../../src/Bot/Assets/downloaded/images\",\n      `${message.id}.jpg`\n    );\n    const previewPath = path.join(\n      __dirname,\n      \"../../src/Bot/Assets/downloaded/images\",\n      `${message.id}-preview.jpg`\n    );\n\n    getContent = Bot.downloadContent(message.id, downloadPath)\n      .then(downloadPath => {\n        console.log(\"premature_resolve\", downloadPath);\n        cp.execSync(\n          `convert -resize 240x jpg:${downloadPath} jpg:${previewPath}`\n        );\n        return {\n          originalContentUrl: `${baseURL}/downloaded/images/${path.basename(\n            downloadPath\n          )}`,\n          previewImageUrl: `${baseURL}/downloaded/images/${path.basename(\n            previewPath\n          )}`\n        };\n      })\n      .catch(err => {\n        throw err;\n      });\n  } else if (message.contentProvider.type === \"external\") {\n    getContent = Promise.resolve(message.contentProvider);\n  }\n\n  return getContent.then(({ originalContentUrl, previewImageUrl }) => {\n    console.log({ originalContentUrl, previewImageUrl });\n    Bot.replyText(\n      `transmitted img url: ${JSON.stringify({\n        originalContentUrl,\n        previewImageUrl\n      })}`\n    );\n    Bot.client.replyMessage({\n      type: \"image\",\n      originalContentUrl,\n      previewImageUrl\n    });\n  });\n};\n\nconst handleVideo = Bot => {\n  const { message, replyToken } = Bot.props.event;\n  let getContent;\n  if (message.contentProvider.type === \"line\") {\n    const downloadPath = path.join(\n      __dirname,\n      \"../../src/Bot/Assets/downloaded/videos\",\n      `${message.id}.mp4`\n    );\n    const previewPath = path.join(\n      __dirname,\n      \"../../src/Bot/Assets/downloaded/videos\",\n      `${message.id}-preview.jpg`\n    );\n\n    getContent = Bot.downloadContent(message.id, downloadPath).then(\n      downloadPath => {\n        // FFmpeg and ImageMagick is needed here to run 'convert'\n        // Please consider about security and performance by yourself\n        cp.execSync(`convert mp4:${downloadPath}[0] jpeg:${previewPath}`);\n\n        return {\n          originalContentUrl: `${baseURL}/downloaded/videos/${path.basename(\n            downloadPath\n          )}`,\n          previewImageUrl: `${baseURL}/downloaded/videos/${path.basename(\n            previewPath\n          )}`\n        };\n      }\n    );\n  } else if (message.contentProvider.type === \"external\") {\n    getContent = Promise.resolve(message.contentProvider);\n  }\n\n  return getContent.then(({ originalContentUrl, previewImageUrl }) => {\n    // Bot.client.replyMessage({\n    //   type: \"video\",\n    //   originalContentUrl,\n    //   previewImageUrl\n    // });\n  });\n};\n\nconst handleAudio = Bot => {\n  const { message, replyToken } = Bot.props.event;\n  let getContent;\n  if (message.contentProvider.type === \"line\") {\n    const downloadPath = path.join(\n      __dirname,\n      \"../../src/Bot/Assets/downloaded/audios\",\n      `${message.id}.m4a`\n    );\n\n    getContent = Bot.downloadContent(message.id, downloadPath).then(\n      downloadPath => {\n        return {\n          originalContentUrl: `${baseURL}/downloaded/audios/${path.basename(\n            downloadPath\n          )}`\n        };\n      }\n    );\n  } else {\n    getContent = Promise.resolve(message.contentProvider);\n  }\n\n  return getContent.then(({ originalContentUrl }) => {\n    // Bot.client.replyMessage({\n    //   type: \"audio\",\n    //   originalContentUrl,\n    //   duration: message.duration\n    // });\n  });\n};\n\nconst handleLocation = Bot => {\n  const { message, replyToken } = Bot.props.event;\n  Bot.client.replyMessage({\n    type: \"location\",\n    title: message.title,\n    address: message.address,\n    latitude: message.latitude,\n    longitude: message.longitude\n  });\n};\n\nconst handleSticker = Bot => {\n  const { message, replyToken } = Bot.props.event;\n  // Bot.client.replyMessage({\n  //   type: \"sticker\",\n  //   packageId: message.packageId,\n  //   stickerId: message.stickerId\n  // });\n};\n"]}