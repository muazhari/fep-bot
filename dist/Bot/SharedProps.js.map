{"version":3,"sources":["../../src/Bot/SharedProps.js"],"names":["SharedPropsFactory","constructor","store","storeUpdateListener","log","sourceId","Promise","resolve","reject","Firebase","fdb","collection","add","console","event","timestamp","Date","rdb","ref","set","SharedProps"],"mappings":";;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AAEA;;;;AACA;;;;AAEA,MAAMA,kBAAN,CAAyB;AACvBC,gBAAc;AACZ,SAAKC,KAAL,GAAa,EAAb;AACA;AACA;AACA;AACA;;AAEA,+BAAM,KAAKA,KAAX,EAAkB,MAAM;AACtB,WAAKC,mBAAL;AACD,KAFD;AAGD;AACDC,MAAIC,QAAJ,EAAc;AACZ,QAAIC,OAAJ,CAAY,OAAOC,OAAP,EAAgBC,MAAhB,KAA2B;AACrC,UAAIH,QAAJ,EAAc;AACZI,2BAASC,GAAT,CAAaC,UAAb,CAAwB,OAAxB,EAAiCC,GAAjC,CAAqC,KAAKV,KAAL,CAAWG,QAAX,CAArC;AACAQ,gBAAQT,GAAR,CAAY,oBAAZ,EAAkCC,QAAlC,EAA4C,KAAKH,KAAL,CAAWG,QAAX,EAAqBS,KAArB,CAA2BC,SAAvE;AACD,OAHD,MAGO;AACLN,2BAASC,GAAT,CAAaC,UAAb,CAAwB,OAAxB,EAAiCC,GAAjC,CAAqC,KAAKV,KAA1C;AACAW,gBAAQT,GAAR,CAAY,oBAAZ,EAAkC,IAAIY,IAAJ,EAAlC;AACD;AACF,KARD;AASD;;AAEDb,wBAAsB;AACpBM,uBAASQ,GAAT,CAAaC,GAAb,CAAiB,aAAjB,EAAgCC,GAAhC,CAAoC,KAAKjB,KAAzC;AACAW,YAAQT,GAAR,CAAY,6BAAZ,EAA2C,IAAIY,IAAJ,EAA3C;AACD;AA3BsB;;AA8BzB,MAAMI,cAAc,IAAIpB,kBAAJ,EAApB;;QAGEoB,W,GAAAA,W","file":"SharedProps.js","sourcesContent":["import Store from \"../Services/Store\";\nimport fs from \"fs-extra\";\nimport mkdirp from \"mkdirp\";\nimport path from \"path\";\nimport uuid from \"uuid\";\n\nimport config from \"../Config/Line\";\n\nimport Firebase from \"../Services/Firebase\";\nimport {watch} from \"melanke-watchjs\";\n\nclass SharedPropsFactory {\n  constructor() {\n    this.store = {};\n    // this.store = new Proxy({}, {\n    //   set: this._set,\n    //   get: this._get\n    // });\n\n    watch(this.store, () => {\n      this.storeUpdateListener();\n    });\n  }\n  log(sourceId) {\n    new Promise(async (resolve, reject) => {\n      if (sourceId) {\n        Firebase.fdb.collection(\"Props\").add(this.store[sourceId]);\n        console.log(\"[LOG] Props logged\", sourceId, this.store[sourceId].event.timestamp);\n      } else {\n        Firebase.fdb.collection(\"Store\").add(this.store);\n        console.log(\"[LOG] Store logged\", new Date());\n      }\n    });\n  }\n\n  storeUpdateListener() {\n    Firebase.rdb.ref(\"SharedProps\").set(this.store);\n    console.log(\"[SharedStore] Store updated\", new Date());\n  }\n}\n\nconst SharedProps = new SharedPropsFactory();\n\nexport {\n  SharedProps\n};\n"]}