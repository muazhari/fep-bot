{"version":3,"sources":["../../../src/Bot/Features/Twibbon.js"],"names":["objectsHaveSameKeys","objects","allKeys","reduce","keys","object","concat","Object","union","Set","every","size","length","Twibbon","Bot","uploads","twibbon_list","twibbon_cs","category","name","url","transform","filename","transformation","gravity","crop","format","aspect_ratio","public_id","width","height","y","Math","floor","x","overlay","flags","twibbon_tfi","twibbon_binus1","twibbon_binus2","twibbon_binus3","ready","args","data","shared_props","getId","user","status","source","id","default","display_list","replyText","command_prefix","listen","twibbon","type","profile","then","res","displayName","selected","map","twibbon_id","pure_selected","filter","item","twibbon_contents","sendMessage","getResult","result","cloudinary","imgUpload","Promise","resolve","reject","uploader","upload","image","console","log","catch","err","warn","waitForAllUploads","queue","imageObject","callback","ids","join","generate","twibbon_bg","performTransformations","twibbon_ori_name","result_url","twibbonSetting","raw","twibbon_preview_name","result_preview_url","original","performResolve","preview","twibbonOriginalUrl","secure_url","twibbonPreviewUrl","fs","unlinkSync","originalPath","previewPath","make","props","event","message","originalContentUrl","previewImageUrl","insert","getContent","userSwitch","undefined","userInSameCommunal","twibbon_id_chosen"],"mappings":"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","file":"Twibbon.js","sourcesContent":["import {command_prefix, batch_list, baseURL, shared_props} from \"../../Bot\";\nimport FEPStoreCRUD from \"../../Bot/Helper/FEPStoreCRUD\";\nimport cloudinary from \"cloudinary\";\nimport fs from \"fs-extra\";\nimport request from \"request\";\nimport cp from \"child_process\";\nimport path from \"path\";\n\nfunction objectsHaveSameKeys(...objects) {\n    const allKeys = objects.reduce((keys, object) => keys.concat(Object.keys(object)), []);\n    const union = new Set(allKeys);\n    return objects.every(object => union.size === Object.keys(object).length);\n}\n\nexport const Twibbon = Bot => {\n    const uploads = {};\n\n    const twibbon_list = {\n        twibbon_cs: {\n            category: \"socs\",\n            name: \"Computer Science\",\n            url: \"https://res.cloudinary.com/fep-bot/image/upload/v1564639746/twibbon_cs.png\",\n            transform: (filename, size) => {\n                return {\n                    transformation: [\n                        {\n                            gravity: \"auto\",\n                            crop: \"fill\",\n                            format: \"jpg\",\n                            aspect_ratio: \"1:1\",\n                            public_id: `${filename}-twibbon`\n                        }, {\n                            gravity: \"auto\",\n                            crop: \"fill_pad\",\n                            width: size,\n                            height: size,\n                            y: Math.floor(-size * 0.2),\n                            x: Math.floor(size * 0.045)\n                        }, {\n                            overlay: \"twibbon_cs.png\",\n                            flags: \"relative\",\n                            width: size,\n                            height: size,\n                            aspect_ratio: \"1:1\"\n                        }\n                    ]\n                }\n            }\n        },\n\n        twibbon_tfi: {\n            category: \"tfi\",\n            name: \"Teach For Indonesia\",\n            url: \"https://res.cloudinary.com/fep-bot/image/upload/v1565361689/twibbon_tfi.png\",\n            transform: (filename, size) => {\n                return {\n                    transformation: [\n                        {\n                            gravity: \"auto\",\n                            crop: \"fill\",\n                            format: \"jpg\",\n                            // aspect_ratio: \"1:1\",\n                            width: size + Math.floor(-size * 0.045),\n                            height: size + Math.floor(size * 0.2),\n                            x: Math.floor(size * 0.045),\n                            y: Math.floor(-size * 0.2),\n                            public_id: `${filename}-twibbon`\n                            \n                        }, {\n                            gravity: \"auto\",\n                            crop: \"fill\",\n                            width: size,\n                            height: size,\n                        }, {\n                            overlay: \"twibbon_tfi.png\",\n                            flags: \"relative\",\n                            width: size,\n                            height: size,\n                            aspect_ratio: \"1:1\"\n                        }\n                    ]\n                }\n            }\n        },\n      \n      twibbon_binus1: {\n            category: \"binus\",\n            name: \"Binus 1\",\n            url: \"https://res.cloudinary.com/fep-bot/image/upload/v1565372081/twibbon_binus1.png\",\n            transform: (filename, size) => {\n                return {\n                    transformation: [\n                        {\n                            gravity: \"auto\",\n                            crop: \"fill\",\n                            format: \"jpg\",\n                            // aspect_ratio: \"1:1\",\n                            width: size - Math.floor(size * 0.2),\n                            height: size - Math.floor(size * 0.2),\n                            public_id: `${filename}-twibbon`,\n                        }, {\n                            overlay: \"twibbon_binus1.png\",\n                            flags: \"relative\",\n                            width: size,\n                            height: size,\n                            aspect_ratio: \"1:1\"\n                        }\n                    ]\n                }\n            }\n        },\n      \n      twibbon_binus2: {\n            category: \"binus\",\n            name: \"Binus 2\",\n            url: \"https://res.cloudinary.com/fep-bot/image/upload/v1565372079/twibbon_binus2.png\",\n            transform: (filename, size) => {\n                return {\n                    transformation: [\n                        {\n                            gravity: \"auto\",\n                            crop: \"fill\",\n                            format: \"jpg\",\n                            // aspect_ratio: \"1:1\",\n                            width: size + Math.floor(-size * 0.045),\n                            height: size + Math.floor(size * 0.2),\n                            x: Math.floor(size * 0.045),\n                            y: Math.floor(-size * 0.2),\n                            public_id: `${filename}-twibbon`\n                            \n                        }, {\n                            gravity: \"auto\",\n                            crop: \"fill\",\n                            width: size,\n                            height: size,\n                        }, {\n                            overlay: \"twibbon_binus2.png\",\n                            flags: \"relative\",\n                            width: size,\n                            height: size,\n                            aspect_ratio: \"1:1\"\n                        }\n                    ]\n                }\n            }\n        },\n      \n      twibbon_binus3: {\n            category: \"binus\",\n            name: \"Binus 3\",\n            url: \"https://res.cloudinary.com/fep-bot/image/upload/v1565372078/twibbon_binus3.png\",\n            transform: (filename, size) => {\n                return {\n                    transformation: [\n                        {\n                            gravity: \"auto\",\n                            crop: \"fill\",\n                            format: \"jpg\",\n                            // aspect_ratio: \"1:1\",\n                            width: size + Math.floor(-size * 0.045),\n                            height: size + Math.floor(size * 0.2),\n                            x: Math.floor(size * 0.045),\n                            y: Math.floor(-size * 0.2),\n                            public_id: `${filename}-twibbon`\n                            \n                        }, {\n                            gravity: \"auto\",\n                            crop: \"fill\",\n                            width: size,\n                            height: size,\n                        }, {\n                            overlay: \"twibbon_binus3.png\",\n                            flags: \"relative\",\n                            width: size,\n                            height: size,\n                            aspect_ratio: \"1:1\"\n                        }\n                    ]\n                }\n            }\n        },\n\n    }\n\n    const ready = (args) => {\n        if (args.length <= 1) {\n            const data = {\n                category: args[0]\n            }\n\n            // ready-up switch\n            shared_props[Bot.getId().user][\"twibbon\"] = {\n                status: true,\n                source: {\n                    id: Bot.getId().default\n                }\n            };\n\n            display_list(data.category || \"all\")\n        } else {\n            Bot.replyText(`${command_prefix}twibbon <type>`);\n        }\n\n    };\n\n    const listen = (data) => {\n        const {user} = Bot.getId()\n\n        if (data.twibbon) {\n            const {id, type} = data.twibbon\n            \n            // ready-up switch\n            shared_props[user][\"twibbon\"] = {\n                id: id,\n                type: type,\n                status: true,\n                source: {\n                    id: Bot.getId().default\n                }\n            }\n          \n            Bot.profile().then(res => {\n              Bot.replyText(`Hai ${res.displayName}, masukan gambar mu disini~`)\n            })\n            \n        }\n    }\n\n    const display_list = (category) => {\n        let selected = []\n        if (category === \"all\") {\n            selected = Object.keys(twibbon_list).map((twibbon_id) => {\n                return twibbon_id\n            })\n        } else {\n            selected = Object.keys(twibbon_list).map((twibbon_id) => {\n                if (twibbon_list[twibbon_id].category === category) {\n                    return twibbon_id\n                }\n            })\n        }\n      \n        const pure_selected = selected.filter((item) => {\n            return typeof item ==='string';  \n        });\n      \n        if (pure_selected.length === 0) {\n            Bot.replyText(`Tidak ada kategori, lihat di ${command_prefix}twibbon`)\n        }\n\n        const twibbon_contents = pure_selected.map(id => {\n          \n            const {url, name} = twibbon_list[id]\n            return {\n                \"thumbnailImageUrl\": url,\n                \"imageBackgroundColor\": \"#FFFFFF\",\n                \"text\": `${name}`,\n                \"actions\": [\n                    {\n                        \"type\": \"postback\",\n                        \"label\": \"Select\",\n                        \"data\": `{\"twibbon\":{\"id\":\"${id}\",\"type\":\"auto\"}}`\n                    }\n                ]\n            }\n        })\n\n        Bot.sendMessage({\n            \"type\": \"template\",\n            \"altText\": \"Twibbon list\",\n            \"template\": {\n                \"type\": \"carousel\",\n                \"columns\": twibbon_contents,\n                \"imageAspectRatio\": \"square\",\n                \"imageSize\": \"cover\"\n            }\n        })\n    }\n\n    const getResult = (twibbon_id, public_id, filename, size) => {\n        const result = cloudinary.url(public_id, twibbon_list[twibbon_id].transform(filename, size))\n        return result;\n    };\n\n    const imgUpload = (url, filename) => {\n        return new Promise((resolve, reject) => {\n            cloudinary.uploader.upload(url, {public_id: filename}).then(image => {\n                console.log(\"** File Upload (Promise)\");\n                console.log(\"* \" + image.public_id);\n                console.log(\"* \" + image.url);\n                resolve(image);\n            }).catch(err => {\n                console.log(\"** File Upload (Promise)\");\n                if (err) {\n                    console.warn(err);\n                    reject(err);\n                }\n            });\n        });\n    };\n\n    const waitForAllUploads = (type, queue, imageObject, callback) => {\n        uploads[type] = {\n            ...uploads[type],\n            ...imageObject\n        };\n        const ids = Object.keys(uploads[type]);\n        if (ids.length === queue) {\n            console.log(\"**  uploaded all raw files (\" + ids.join(\",\") + \") to cloudinary\");\n            callback();\n        }\n\n    };\n\n    const generate = (data) => {\n        return new Promise((resolve, reject) => {\n            imgUpload(data.url, data.filename).then(image => {\n                waitForAllUploads(\"raw\", 1, {\n                    twibbon_bg: image\n                }, performTransformations);\n            });\n\n            const performTransformations = () => {\n                const twibbon_ori_name = `${data.filename}-twibbon`;\n                const result_url = getResult(data.twibbonSetting.id, uploads.raw.twibbon_bg.public_id, twibbon_ori_name, 1040);\n\n                const twibbon_preview_name = `${data.filename}-twibbon-preview`;\n                const result_preview_url = getResult(data.twibbonSetting.id, uploads.raw.twibbon_bg.public_id, twibbon_preview_name, 240);\n\n                imgUpload(result_url, twibbon_ori_name).then(image => {\n                    waitForAllUploads(\"twibbon\", 2, {\n                        original: image\n                    }, performResolve);\n                });\n\n                imgUpload(result_preview_url, twibbon_preview_name).then(image => {\n                    waitForAllUploads(\"twibbon\", 2, {\n                        preview: image\n                    }, performResolve);\n                });\n\n                const performResolve = () => {\n                    resolve({twibbonOriginalUrl: `${uploads.twibbon.original.secure_url}`, twibbonPreviewUrl: `${uploads.twibbon.preview.secure_url}`});\n\n                    fs.unlinkSync(data.originalPath);\n                    fs.unlinkSync(data.previewPath);\n                };\n            };\n        });\n    }\n\n    const make = args => {\n        if (args.length === 4) {\n            const data = {\n                url: args[0],\n                originalPath: args[1],\n                previewPath: args[2],\n                twibbonSetting: args[3],\n                filename: Bot.props.event.message.id\n            };\n\n            generate(data).then(({twibbonOriginalUrl, twibbonPreviewUrl}) => {\n                Bot.sendMessage({type: \"image\", originalContentUrl: twibbonOriginalUrl, previewImageUrl: twibbonPreviewUrl});\n            })\n\n            //switch back\n            shared_props[Bot.getId().user].twibbon.status = false\n\n        } else {\n            Bot.replyText(`${command_prefix}twibbon <image>`);\n        }\n    };\n\n    const insert = (getContent) => {\n        const {user} = Bot.getId()\n\n        const userSwitch = shared_props[user].twibbon.status === undefined\n            ? false\n            : shared_props[user].twibbon.status;\n\n        const userInSameCommunal = shared_props[user].twibbon.source.id === Bot.getId().default\n\n        const twibbon_id_chosen = shared_props[user].twibbon.id !== undefined\n\n        if (userSwitch && userInSameCommunal && twibbon_id_chosen) {\n            const twibbonSetting = {\n                id: shared_props[user].twibbon.id,\n                type: shared_props[user].twibbon.type\n            }\n\n            getContent().then(({originalPath, previewPath, originalContentUrl, previewImageUrl}) => {\n                make([originalContentUrl, originalPath, previewPath, twibbonSetting])\n            });\n        }\n\n    }\n\n    return {ready, insert, listen};\n};\n"]}