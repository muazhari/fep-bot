{"version":3,"sources":["../../../../src/Bot/Helper/YoutubeDL/index.js"],"names":["YoutubeDL","constructor","url","getInfo","bind","generateUrl","res","resolution","options","Promise","resolve","reject","youtubedl","err","info","urlName","Store","getStore","then","urlCache","force","ResponseCheck","status","urlStatus","thumbnail","setStore","catch"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEe,MAAMA,SAAN,CAAgB;AAC7BC,cAAYC,GAAZ,EAAiB;AACf,SAAKA,GAAL,GAAWA,GAAX;AACA,SAAKC,OAAL,GAAe,KAAKA,OAAL,CAAaC,IAAb,CAAkB,IAAlB,CAAf;AACA,SAAKC,WAAL,GAAmB,KAAKA,WAAL,CAAiBD,IAAjB,CAAsB,IAAtB,CAAnB;AACD;;AAEDD,UAAQG,GAAR,EAAa;AACX,UAAMC,aAAaD,OAAO,GAA1B;AACA;AACA,UAAME,UAAU,EAAhB;;AAEA,WAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCC,0BAAUT,OAAV,CAAkB,KAAKD,GAAvB,EAA4BM,OAA5B,EAAqC,CAACK,GAAD,EAAMC,IAAN,KAAe;AAClD,YAAID,GAAJ,EAAS;AACPF,iBAAOE,GAAP;AACA,gBAAMA,GAAN;AACD;AACD,eAAOH,QAAQI,IAAR,CAAP;AACD,OAND;AAOD,KARM,CAAP;AASD;;AAEDT,cAAYU,OAAZ,EAAqBP,OAArB,EAA8B;AAC5B,WAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCK,sBAAMC,QAAN,CAAe,UAAf,EAA2BC,IAA3B,CAAgCC,YAAY;AAC1C,YAAIA,YAAYA,SAASJ,OAAT,CAAZ,IAAiCP,QAAQY,KAAR,KAAkB,KAAvD,EAA8D;AAC5DC,kCAAcC,MAAd,CAAqBH,SAASJ,OAAT,EAAkBb,GAAvC,EAA4CgB,IAA5C,CAAiDK,aAAa;AAC5D,gBAAIA,cAAc,GAAlB,EAAuB;AACrB,mBAAKpB,OAAL,GAAee,IAAf,CAAoB,CAAC,EAAChB,GAAD,EAAMsB,SAAN,EAAD,KAAsB;AACxCL,yBAASJ,OAAT,IAAoB;AAClBb,qBADkB;AAElBsB;AAFkB,iBAApB;AAIAR,gCAAMS,QAAN,CAAe,EAACN,UAAUA,QAAX,EAAf,EAAqCD,IAArC,CAA0C,MAAM;AAC9CR,0BAAQ,EAACR,GAAD,EAAMsB,SAAN,EAAR;AACD,iBAFD;AAGD,eARD,EAQGE,KARH,CAQSf,MART;AASD,aAVD,MAUO;AACLD,sBAAQS,SAASJ,OAAT,CAAR;AACD;AACF,WAdD;AAeD,SAhBD,MAgBO;AACLI,qBAAW,EAAX;AACA,eAAKhB,OAAL,GAAee,IAAf,CAAoB,CAAC,EAAChB,GAAD,EAAMsB,SAAN,EAAD,KAAsB;AACxCL,qBAASJ,OAAT,IAAoB;AAClBb,iBADkB;AAElBsB;AAFkB,aAApB;AAIAR,4BAAMS,QAAN,CAAe,EAACN,UAAUA,QAAX,EAAf,EAAqCD,IAArC,CAA0C,MAAM;AAC9CR,sBAAQS,SAASJ,OAAT,CAAR;AACD,aAFD;AAGD,WARD,EAQGW,KARH,CAQSf,MART;AASD;AACF,OA7BD;AA8BD,KA/BM,CAAP;AAgCD;AAxD4B;kBAAVX,S","file":"index.js","sourcesContent":["import youtubedl from \"youtube-dl\";\nimport ResponseCheck from \"../../../Bot/Helper/ResponseCheck\";\nimport Store from \"../../../Services/Store\";\n\nexport default class YoutubeDL {\n  constructor(url) {\n    this.url = url;\n    this.getInfo = this.getInfo.bind(this);\n    this.generateUrl = this.generateUrl.bind(this);\n  }\n\n  getInfo(res) {\n    const resolution = res || 480;\n    // const options = [`-f 'bestvideo[height<=${resolution}]+bestaudio/best[height<=${resolution}]'`]\n    const options = [];\n\n    return new Promise((resolve, reject) => {\n      youtubedl.getInfo(this.url, options, (err, info) => {\n        if (err) {\n          reject(err);\n          throw err;\n        }\n        return resolve(info);\n      });\n    });\n  }\n\n  generateUrl(urlName, options) {\n    return new Promise((resolve, reject) => {\n      Store.getStore(\"urlCache\").then(urlCache => {\n        if (urlCache && urlCache[urlName] && options.force === false) {\n          ResponseCheck.status(urlCache[urlName].url).then(urlStatus => {\n            if (urlStatus !== 200) {\n              this.getInfo().then(({url, thumbnail}) => {\n                urlCache[urlName] = {\n                  url,\n                  thumbnail\n                };\n                Store.setStore({urlCache: urlCache}).then(() => {\n                  resolve({url, thumbnail});\n                });\n              }).catch(reject);\n            } else {\n              resolve(urlCache[urlName]);\n            }\n          });\n        } else {\n          urlCache = {};\n          this.getInfo().then(({url, thumbnail}) => {\n            urlCache[urlName] = {\n              url,\n              thumbnail\n            };\n            Store.setStore({urlCache: urlCache}).then(() => {\n              resolve(urlCache[urlName]);\n            });\n          }).catch(reject);\n        }\n      });\n    });\n  }\n}\n"]}