{"version":3,"sources":["../../src/Bot/handlerBot.js"],"names":["baseURL","process","env","BASE_URL","batch_list","a","b","c","d","e","command_prefix","commandValidate","chat","prefix","command","slice","length","args","map","item","trim","console","log","handleCommand","commandList","content_prefix","content_command","content_args","Object","keys","includes","userQueue","Bot","queue","increment","user","userId","getId","decrement","handlerBot","event","Worker","type","message","handleText","handleImage","handleVideo","handleAudio","handleLocation","handleSticker","Error","JSON","stringify","client","getProfile","joined","members","then","profile","replyText","displayName","source","data","postback","params","objectData","parse","Twibbon","Features","listen","beacon","hwid","replyToken","props","FEPList","StoreAdvance","Basic","Template","Courses","PosetLattice","add","upd","update","rem","remove","view","rstore","reset_store","pstore","pre_store","bstore","backup_store","admin","help","button","confirm","bifest","greet","say","twibbon","ready","algo","pl","generate","chat_splitted","text","split","msgToCmdValidate","getContent","contentProvider","downloadPath","path","join","__dirname","id","previewPath","downloadContent","cp","execSync","originalPath","originalContentUrl","basename","previewImageUrl","catch","err","Promise","resolve","insert","sendMessage","title","address","latitude","longitude"],"mappings":"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","file":"handlerBot.js","sourcesContent":["import fs from \"fs-extra\";\nimport path from \"path\";\nimport cp from \"child_process\";\nimport {Bot, handlerDialogFlow, shared_props} from \"./internal\";\n\n// base URL for webhook server\nexport const baseURL = process.env.BASE_URL;\n\nexport const batch_list = {\n  a: \"22 - 27 JULI 2019\",\n  b: \"29 JULI - 3 AGUSTUS 2019\",\n  c: \"5 - 10 AGUSTUS 2019\",\n  d: \"19 - 24 AGUSTUS 2019\",\n  e: \"26 - 03 SEPTEMBER 2019\"\n};\n\nexport const command_prefix = \"/\";\n\nconst commandValidate = chat => {\n  const prefix = chat[0][0];\n  const command = chat[0].slice(1, chat[0].length);\n  const args = chat.slice(1, chat.length).map(item => item.trim());\n\n  if (prefix === command_prefix) {\n    console.log({prefix, command, args});\n    return {prefix, command, args};\n  } else {\n    return false;\n  }\n};\n\nconst handleCommand = (commandList, commandValidate) => {\n  const {prefix: content_prefix, command: content_command, args: content_args} = commandValidate;\n\n  if (Object.keys(commandList).includes(content_command)) {\n    if (commandList[content_command].length >= 1) {\n      commandList[content_command](content_args);\n    } else {\n      commandList[content_command]();\n    }\n  }\n};\n\nconst userQueue = Bot => {\n  const queue = {};\n\n  const increment = () => {\n    const {user: userId} = Bot.getId();\n    if (!queue[userId]) {\n      queue[userId] = 0;\n    }\n    queue[userId] += 1;\n  };\n\n  const decrement = () => {\n    const {user: userId} = Bot.getId();\n    if (!queue[userId]) {\n      queue[userId] = 0;\n    }\n    if (queue[userId] >= 1) {\n      queue[userId] -= 1;\n    }\n  };\n\n  return {increment, decrement};\n};\n\nexport const handlerBot = event => {\n  console.log(event);\n\n  const Worker = new Bot({event});\n  // Worker.log()\n\n  // const whitelist = Worker.Features.Access.whitelist();\n  // console.log(whitelist);\n  // const type = whitelist.user || whitelist.room ? event.type : null;\n\n  switch (event.type) {\n    case \"message\":\n      const {message} = event;\n      switch (message.type) {\n        case \"text\":\n          return handleText(Worker);\n        case \"image\":\n          return handleImage(Worker);\n        case \"video\":\n          return handleVideo(Worker);\n        case \"audio\":\n          return handleAudio(Worker);\n        case \"location\":\n          return handleLocation(Worker);\n        case \"sticker\":\n          return handleSticker(Worker);\n        default:\n          throw new Error(`Unknown message: ${JSON.stringify(message)}`);\n      }\n\n    case \"memberJoined\":\n      return Worker.client.getProfile(event.joined.members[0].userId).then(profile => {\n        Worker.replyText(`Welcome ${profile.displayName}! Jangan lupa cek notes di group ya!`);\n      });\n\n    case \"follow\":\n      return Worker.replyText(\"Got followed event\");\n\n    case \"unfollow\":\n      return console.log(`Unfollowed this bot: ${JSON.stringify(event)}`);\n\n    case \"join\":\n      return Worker.replyText(`Joined ${event.source.type}`);\n\n    case \"leave\":\n      return console.log(`Left: ${JSON.stringify(event)}`);\n\n    case \"postback\":\n      let {data} = event.postback;\n      if (data === \"DATE\" || data === \"TIME\" || data === \"DATETIME\") {\n        data += `(${JSON.stringify(event.postback.params)})`;\n      }\n\n      const objectData = JSON.parse(data);\n\n      const {Twibbon} = Worker.Features;\n      Twibbon.listen(objectData);\n\n      break;\n\n    case \"beacon\":\n      return Worker.replyText(`Got beacon: ${event.beacon.hwid}`);\n\n    default:\n      throw new Error(`Unknown event: ${JSON.stringify(event)}`);\n  }\n};\n\nconst handleText = Bot => {\n  const {message, replyToken, source} = Bot.props.event;\n  const {\n    FEPList,\n    StoreAdvance,\n    Basic,\n    Template,\n    Twibbon,\n    Courses,\n    PosetLattice\n  } = Bot.Features;\n\n  const commandList = {\n    add: FEPList.add,\n    upd: FEPList.update,\n    rem: FEPList.remove,\n    view: FEPList.view,\n    rstore: StoreAdvance.reset_store,\n    pstore: StoreAdvance.pre_store,\n    bstore: StoreAdvance.backup_store,\n    \"]]\": Basic.admin,\n    help: Basic.help,\n    button: Template.button,\n    profile: Basic.profile,\n    confirm: Template.confirm,\n    bifest: Template.bifest,\n    greet: Basic.greet,\n    say: Basic.say,\n    twibbon: Twibbon.ready,\n    algo: Courses.algo,\n    pl: PosetLattice.generate\n  };\n\n  // The text query request.\n  const chat_splitted = message.text.split(\" \");\n  const msgToCmdValidate = commandValidate(chat_splitted);\n  if (msgToCmdValidate) {\n    handleCommand(commandList, msgToCmdValidate);\n  } else {\n    // hidden error, need fix\n    handlerDialogFlow(Bot);\n  }\n};\n\nconst handleImage = Bot => {\n  const {message, replyToken} = Bot.props.event;\n  let getContent;\n\n  if (message.contentProvider.type === \"line\") {\n    const downloadPath = path.join(__dirname, \"../../src/Bot/Assets/downloaded/images\", `${message.id}.jpg`);\n    const previewPath = path.join(__dirname, \"../../src/Bot/Assets/downloaded/images\", `${message.id}-preview.jpg`);\n\n    getContent = () => {\n      return Bot.downloadContent(message.id, downloadPath).then(downloadPath => {\n        console.log(\"premature_resolve\", downloadPath);\n        cp.execSync(`convert -resize 240x jpg:${downloadPath} jpg:${previewPath}`);\n        return {originalPath: downloadPath, previewPath: previewPath, originalContentUrl: `${baseURL}/downloaded/images/${path.basename(downloadPath)}`, previewImageUrl: `${baseURL}/downloaded/images/${path.basename(previewPath)}`};\n      }).catch(err => {\n        throw err;\n      });\n    };\n  } else if (message.contentProvider.type === \"external\") {\n    getContent = () => {\n      return Promise.resolve(message.contentProvider);\n    };\n  }\n\n  // Twibbon switch\n  const {Twibbon} = Bot.Features;\n  Twibbon.insert(getContent);\n};\n\nconst handleVideo = Bot => {\n  const {message, replyToken} = Bot.props.event;\n  let getContent;\n  if (message.contentProvider.type === \"line\") {\n    const downloadPath = path.join(__dirname, \"../../src/Bot/Assets/downloaded/videos\", `${message.id}.mp4`);\n    const previewPath = path.join(__dirname, \"../../src/Bot/Assets/downloaded/videos\", `${message.id}-preview.jpg`);\n\n    getContent = Bot.downloadContent(message.id, downloadPath).then(downloadPath => {\n      // FFmpeg and ImageMagick is needed here to run 'convert'\n      // Please consider about security and performance by yourself\n      cp.execSync(`convert mp4:${downloadPath}[0] jpeg:${previewPath}`);\n\n      return {originalContentUrl: `${baseURL}/downloaded/videos/${path.basename(downloadPath)}`, previewImageUrl: `${baseURL}/downloaded/videos/${path.basename(previewPath)}`};\n    });\n  } else if (message.contentProvider.type === \"external\") {\n    getContent = Promise.resolve(message.contentProvider);\n  }\n\n  return getContent.then(({originalContentUrl, previewImageUrl}) => {\n    // Bot.sendMessage({\n    //   type: \"video\",\n    //   originalContentUrl,\n    //   previewImageUrl\n    // });\n  });\n};\n\nconst handleAudio = Bot => {\n  const {message, replyToken} = Bot.props.event;\n  let getContent;\n  if (message.contentProvider.type === \"line\") {\n    const downloadPath = path.join(__dirname, \"../../src/Bot/Assets/downloaded/audios\", `${message.id}.m4a`);\n\n    getContent = Bot.downloadContent(message.id, downloadPath).then(downloadPath => {\n      return {originalContentUrl: `${baseURL}/downloaded/audios/${path.basename(downloadPath)}`};\n    });\n  } else {\n    getContent = Promise.resolve(message.contentProvider);\n  }\n\n  return getContent.then(({originalContentUrl}) => {\n    // Bot.sendMessage({\n    //   type: \"audio\",\n    //   originalContentUrl,\n    //   duration: message.duration\n    // });\n  });\n};\n\nconst handleLocation = Bot => {\n  const {message, replyToken} = Bot.props.event;\n  Bot.sendMessage({type: \"location\", title: message.title, address: message.address, latitude: message.latitude, longitude: message.longitude});\n};\n\nconst handleSticker = Bot => {\n  const {message, replyToken} = Bot.props.event;\n  // Bot.sendMessage({\n  //   type: \"sticker\",\n  //   packageId: message.packageId,\n  //   stickerId: message.stickerId\n  // });\n};\n"]}