{"version":3,"sources":["../../src/Bot/handlerBot.js"],"names":["baseURL","process","env","BASE_URL","batch_list","a","b","c","d","e","command_prefix","destructCommand","chat","prefix","command","slice","length","args","map","item","trim","console","log","handleCommand","features","FEPList","StoreAdvance","Basic","Template","Twibbon","Courses","PosetLattice","commandList","add","upd","update","rem","remove","view","rstore","reset_store","pstore","pre_store","bstore","backup_store","admin","help","button","profile","confirm","bifest","greet","say","twibbon","ready","algo","pl","generate","content_prefix","content_command","content_args","Object","keys","includes","userQueue","userId","queue","increment","decrement","handlerBot","constructor","Bot","Features","eventListener","props","event","type","message","handleText","handleImage","handleVideo","handleAudio","handleLocation","handleSticker","Error","JSON","stringify","client","getProfile","joined","members","then","replyText","displayName","source","data","postback","params","objectData","parse","listenPostback","beacon","replyToken","splittedChat","text","split","isTextCommand","dialogFlow","listen","getContent","imageData","originalPath","path","join","__dirname","id","previewPath","originalContentUrl","previewImageUrl","contentProvider","downloadContent","cp","execSync","catch","err","Promise","resolve","url","basename","CloudinaryUtils","upload","fileMeta","fs","unlinkSync","listenImage","downloadPath","sendMessage","title","address","latitude","longitude"],"mappings":";;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;;;AAEA;AACO,MAAMA,4BAAUC,QAAQC,GAAR,CAAYC,QAA5B;;AAEA,MAAMC,kCAAa;AACxBC,KAAG,mBADqB;AAExBC,KAAG,0BAFqB;AAGxBC,KAAG,qBAHqB;AAIxBC,KAAG,sBAJqB;AAKxBC,KAAG;AALqB,CAAnB;;AAQA,MAAMC,0CAAiB,GAAvB;;AAEP,MAAMC,kBAAkBC,QAAQ;AAC9B,QAAMC,SAASD,KAAK,CAAL,EAAQ,CAAR,CAAf;AACA,QAAME,UAAUF,KAAK,CAAL,EAAQG,KAAR,CAAc,CAAd,EAAiBH,KAAK,CAAL,EAAQI,MAAzB,CAAhB;AACA,QAAMC,OAAOL,KAAKG,KAAL,CAAW,CAAX,EAAcH,KAAKI,MAAnB,EAA2BE,GAA3B,CAA+BC,QAAQA,KAAKC,IAAL,EAAvC,CAAb;;AAEAC,UAAQC,GAAR,CAAY,EAAET,MAAF,EAAUC,OAAV,EAAmBG,IAAnB,EAAZ;AACA,SAAO,EAAEJ,MAAF,EAAUC,OAAV,EAAmBG,IAAnB,EAAP;AACD,CAPD;;AASA,MAAMM,gBAAgB,CAACC,QAAD,EAAWV,OAAX,KAAuB;AAC3C,QAAM;AACJW,WADI;AAEJC,gBAFI;AAGJC,SAHI;AAIJC,YAJI;AAKJC,WALI;AAMJC,WANI;AAOJC;AAPI,MAQFP,QARJ;;AAUA,QAAMQ,cAAc;AAClBC,SAAKR,QAAQQ,GADK;AAElBC,SAAKT,QAAQU,MAFK;AAGlBC,SAAKX,QAAQY,MAHK;AAIlBC,UAAMb,QAAQa,IAJI;AAKlBC,YAAQb,aAAac,WALH;AAMlBC,YAAQf,aAAagB,SANH;AAOlBC,YAAQjB,aAAakB,YAPH;AAQlB,UAAMjB,MAAMkB,KARM;AASlBC,UAAMnB,MAAMmB,IATM;AAUlBC,YAAQnB,SAASmB,MAVC;AAWlBC,aAASrB,MAAMqB,OAXG;AAYlBC,aAASrB,SAASqB,OAZA;AAalBC,YAAQtB,SAASsB,MAbC;AAclBC,WAAOxB,MAAMwB,KAdK;AAelBC,SAAKzB,MAAMyB,GAfO;AAgBlBC,aAASxB,QAAQyB,KAhBC;AAiBlBC,UAAMzB,QAAQyB,IAjBI;AAkBlBC,QAAIzB,aAAa0B;AAlBC,GAApB;;AAqBA,QAAM;AACJ5C,YAAQ6C,cADJ;AAEJ5C,aAAS6C,eAFL;AAGJ1C,UAAM2C;AAHF,MAIFjD,gBAAgBG,OAAhB,CAJJ;;AAMA,MAAI+C,OAAOC,IAAP,CAAY9B,WAAZ,EAAyB+B,QAAzB,CAAkCJ,eAAlC,CAAJ,EAAwD;AACtD,QAAI3B,YAAY2B,eAAZ,EAA6B3C,MAA7B,IAAuC,CAA3C,EAA8C;AAC5CgB,kBAAY2B,eAAZ,EAA6BC,YAA7B;AACD,KAFD,MAEO;AACL5B,kBAAY2B,eAAZ;AACD;AACF;AACF,CA7CD;;AA+CA,MAAMK,YAAYC,UAAU;AAC1B,QAAMC,QAAQ,EAAd;;AAEA,QAAMC,YAAY,MAAM;AACtB,QAAI,CAACD,MAAMD,MAAN,CAAL,EAAoB;AAClBC,YAAMD,MAAN,IAAgB,CAAhB;AACD;AACDC,UAAMD,MAAN,KAAiB,CAAjB;AACD,GALD;;AAOA,QAAMG,YAAY,MAAM;AACtB,QAAI,CAACF,MAAMD,MAAN,CAAL,EAAoB;AAClBC,YAAMD,MAAN,IAAgB,CAAhB;AACD;AACD,QAAIC,MAAMD,MAAN,KAAiB,CAArB,EAAwB;AACtBC,YAAMD,MAAN,KAAiB,CAAjB;AACD;AACF,GAPD;;AASA,SAAO,EAAEE,SAAF,EAAaC,SAAb,EAAP;AACD,CApBD;;AAsBO,MAAMC,UAAN,CAAiB;AACtBC,cAAYC,GAAZ,EAAiB;AACf,SAAKA,GAAL,GAAWA,GAAX;AACA,SAAK/C,QAAL,GAAgB+C,IAAIC,QAApB;AACA,SAAKC,aAAL,CAAmBF,IAAIG,KAAJ,CAAUC,KAA7B;AACD;;AAEDF,gBAAcE,KAAd,EAAqB;AACnBtD,YAAQC,GAAR,CAAYqD,KAAZ;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,YAAQA,MAAMC,IAAd;AACE,WAAK,SAAL;AACE,cAAM,EAAEC,OAAF,KAAcF,KAApB;AACA,gBAAQE,QAAQD,IAAhB;AACE,eAAK,MAAL;AACE,mBAAO,KAAKE,UAAL,EAAP;AACF,eAAK,OAAL;AACE,mBAAO,KAAKC,WAAL,EAAP;AACF,eAAK,OAAL;AACE,mBAAO,KAAKC,WAAL,EAAP;AACF,eAAK,OAAL;AACE,mBAAO,KAAKC,WAAL,EAAP;AACF,eAAK,UAAL;AACE,mBAAO,KAAKC,cAAL,EAAP;AACF,eAAK,SAAL;AACE,mBAAO,KAAKC,aAAL,EAAP;AACF;AACE,kBAAM,IAAIC,KAAJ,CAAW,oBAAmBC,KAAKC,SAAL,CAAeT,OAAf,CAAwB,EAAtD,CAAN;AAdJ;;AAiBF,WAAK,cAAL;AACE,eAAO,KAAKN,GAAL,CAASgB,MAAT,CACJC,UADI,CACOb,MAAMc,MAAN,CAAaC,OAAb,CAAqB,CAArB,EAAwBzB,MAD/B,EAEJ0B,IAFI,CAEC3C,WAAW;AACf,eAAKuB,GAAL,CAASqB,SAAT,CACG,WAAU5C,QAAQ6C,WAAY,sCADjC;AAGD,SANI,CAAP;;AAQF,WAAK,QAAL;AACE,eAAO,KAAKtB,GAAL,CAASqB,SAAT,CAAmB,oBAAnB,CAAP;;AAEF,WAAK,UAAL;AACE,eAAOvE,QAAQC,GAAR,CAAa,wBAAuB+D,KAAKC,SAAL,CAAeX,KAAf,CAAsB,EAA1D,CAAP;;AAEF,WAAK,MAAL;AACE,eAAO,KAAKJ,GAAL,CAASqB,SAAT,CAAoB,UAASjB,MAAMmB,MAAN,CAAalB,IAAK,EAA/C,CAAP;;AAEF,WAAK,OAAL;AACE,eAAOvD,QAAQC,GAAR,CAAa,SAAQ+D,KAAKC,SAAL,CAAeX,KAAf,CAAsB,EAA3C,CAAP;;AAEF,WAAK,UAAL;AACE,YAAI,EAAEoB,IAAF,KAAWpB,MAAMqB,QAArB;AACA,YAAID,SAAS,MAAT,IAAmBA,SAAS,MAA5B,IAAsCA,SAAS,UAAnD,EAA+D;AAC7DA,kBAAS,IAAGV,KAAKC,SAAL,CAAeX,MAAMqB,QAAN,CAAeC,MAA9B,CAAsC,GAAlD;AACD;;AAED,cAAMC,aAAab,KAAKc,KAAL,CAAWJ,IAAX,CAAnB;;AAEA,cAAM,EAAElE,OAAF,KAAc,KAAK0C,GAAL,CAASC,QAA7B;AACA3C,gBAAQuE,cAAR,CAAuBF,UAAvB;;AAEA;;AAEF,WAAK,QAAL;AACE,eAAO,KAAK3B,GAAL,CAASqB,SAAT,CAAoB,eAAcjB,MAAM0B,MAAO,EAA/C,CAAP;;AAEF;AACE,cAAM,IAAIjB,KAAJ,CAAW,kBAAiBC,KAAKC,SAAL,CAAeX,KAAf,CAAsB,EAAlD,CAAN;AA1DJ;AA4DD;;AAEDG,eAAa;AACX,UAAM,EAAED,OAAF,EAAWyB,UAAX,EAAuBR,MAAvB,KAAkC,KAAKvB,GAAL,CAASG,KAAT,CAAeC,KAAvD;;AAEA;AACA,UAAM4B,eAAe1B,QAAQ2B,IAAR,CAAaC,KAAb,CAAmB,GAAnB,CAArB;AACA,UAAMC,gBAAgBH,aAAa,CAAb,EAAgB,CAAhB,MAAuB7F,cAA7C;AACA,QAAIgG,aAAJ,EAAmB;AACjBnF,oBAAc,KAAKgD,GAAL,CAASC,QAAvB,EAAiC+B,YAAjC;AACD,KAFD,MAEO;AACL;AACA,WAAKhC,GAAL,CAASoC,UAAT,CAAoBC,MAApB;AACD;AACF;;AAED7B,gBAAc;AACZ,UAAM,EAAEF,OAAF,EAAWyB,UAAX,KAA0B,KAAK/B,GAAL,CAASG,KAAT,CAAeC,KAA/C;AACA,QAAIkC,UAAJ;;AAEA,UAAMC,YAAY;AAChBC,oBAAcC,eAAKC,IAAL,CACZC,SADY,EAEZ,wCAFY,EAGX,GAAErC,QAAQsC,EAAG,MAHF,CADE;AAMhBC,mBAAaJ,eAAKC,IAAL,CACXC,SADW,EAEX,wCAFW,EAGV,GAAErC,QAAQsC,EAAG,cAHH,CANG;AAWhBE,0BAAqB,GAAErH,OAAQ,sBAAqB6E,QAAQsC,EAAG,MAX/C;AAYhBG,uBAAkB,GAAEtH,OAAQ,sBAAqB6E,QAAQsC,EAAG;AAZ5C,KAAlB;;AAeA,QAAItC,QAAQ0C,eAAR,CAAwB3C,IAAxB,KAAiC,MAArC,EAA6C;AAC3CiC,mBAAa,MAAM;AACjB,eAAO,KAAKtC,GAAL,CAASiD,eAAT,CAAyB3C,QAAQsC,EAAjC,EACJxB,IADI,CACC,MAAM;AACVtE,kBAAQC,GAAR,CAAY,uBAAZ,EAAqCwF,UAAUC,YAA/C;AACAU,kCAAGC,QAAH,CACG,4BAA2BZ,UAAUC,YAAa,QAAOD,UAAUM,WAAY,EADlF;AAGA,iBAAON,SAAP;AACD,SAPI,EAQJa,KARI,CAQEC,OAAO;AACZ,gBAAMA,GAAN;AACD,SAVI,CAAP;AAWD,OAZD;AAaD,KAdD,MAcO,IAAI/C,QAAQ0C,eAAR,CAAwB3C,IAAxB,KAAiC,UAArC,EAAiD;AACtDiC,mBAAa,MAAM;AACjB,eAAOgB,QAAQC,OAAR,CAAgBjD,QAAQ0C,eAAxB,CAAP;AACD,OAFD;AAGD;;AAED,SAAKhD,GAAL,CAASiD,eAAT,CAAyB3C,QAAQsC,EAAjC,EAAqCL,UAAUC,YAA/C,EAA6DpB,IAA7D,CAAkE,MAAM;AACtE,YAAMoC,MAAO,GAAE/H,OAAQ,sBAAqBgH,eAAKgB,QAAL,CAC1ClB,UAAUC,YADgC,CAE1C,EAFF;AAGAkB,gCAAgBC,MAAhB,CAAuBH,GAAvB,EAA4BlD,QAAQsC,EAApC,EAAwCxB,IAAxC,CAA6CwC,YAAY;AACvDC,0BAAGC,UAAH,CAAcvB,UAAUC,YAAxB;AACD,OAFD;AAGD,KAPD;;AASA;AACA,UAAM,EAAElF,OAAF,KAAc,KAAK0C,GAAL,CAASC,QAA7B;AACA3C,YAAQyG,WAAR,CAAoBzB,UAApB;AACD;;AAED7B,gBAAc;AACZ,UAAM,EAAEH,OAAF,EAAWyB,UAAX,KAA0B,KAAK/B,GAAL,CAASG,KAAT,CAAeC,KAA/C;AACA,QAAIkC,UAAJ;AACA,QAAIhC,QAAQ0C,eAAR,CAAwB3C,IAAxB,KAAiC,MAArC,EAA6C;AAC3C,YAAM2D,eAAevB,eAAKC,IAAL,CACnBC,SADmB,EAEnB,wCAFmB,EAGlB,GAAErC,QAAQsC,EAAG,MAHK,CAArB;AAKA,YAAMC,cAAcJ,eAAKC,IAAL,CAClBC,SADkB,EAElB,wCAFkB,EAGjB,GAAErC,QAAQsC,EAAG,cAHI,CAApB;;AAMAN,mBAAa,KAAKtC,GAAL,CAASiD,eAAT,CAAyB3C,QAAQsC,EAAjC,EAAqCoB,YAArC,EAAmD5C,IAAnD,CACX4C,gBAAgB;AACd;AACA;AACAd,gCAAGC,QAAH,CAAa,eAAca,YAAa,YAAWnB,WAAY,EAA/D;;AAEA,eAAO;AACLC,8BAAqB,GAAErH,OAAQ,sBAAqBgH,eAAKgB,QAAL,CAClDO,YADkD,CAElD,EAHG;AAILjB,2BAAkB,GAAEtH,OAAQ,sBAAqBgH,eAAKgB,QAAL,CAC/CZ,WAD+C,CAE/C;AANG,SAAP;AAQD,OAdU,CAAb;AAgBD,KA5BD,MA4BO,IAAIvC,QAAQ0C,eAAR,CAAwB3C,IAAxB,KAAiC,UAArC,EAAiD;AACtDiC,mBAAagB,QAAQC,OAAR,CAAgBjD,QAAQ0C,eAAxB,CAAb;AACD;;AAED,WAAOV,WAAWlB,IAAX,CAAgB,CAAC,EAAE0B,kBAAF,EAAsBC,eAAtB,EAAD,KAA6C;AAClE;AACA;AACA;AACA;AACA;AACD,KANM,CAAP;AAOD;;AAEDrC,gBAAc;AACZ,UAAM,EAAEJ,OAAF,EAAWyB,UAAX,KAA0B,KAAK/B,GAAL,CAASG,KAAT,CAAeC,KAA/C;AACA,QAAIkC,UAAJ;AACA,QAAIhC,QAAQ0C,eAAR,CAAwB3C,IAAxB,KAAiC,MAArC,EAA6C;AAC3C,YAAM2D,eAAevB,eAAKC,IAAL,CACnBC,SADmB,EAEnB,wCAFmB,EAGlB,GAAErC,QAAQsC,EAAG,MAHK,CAArB;;AAMAN,mBAAa,KAAKtC,GAAL,CAASiD,eAAT,CAAyB3C,QAAQsC,EAAjC,EAAqCoB,YAArC,EAAmD5C,IAAnD,CACX4C,gBAAgB;AACd,eAAO;AACLlB,8BAAqB,GAAErH,OAAQ,sBAAqBgH,eAAKgB,QAAL,CAClDO,YADkD,CAElD;AAHG,SAAP;AAKD,OAPU,CAAb;AASD,KAhBD,MAgBO;AACL1B,mBAAagB,QAAQC,OAAR,CAAgBjD,QAAQ0C,eAAxB,CAAb;AACD;;AAED,WAAOV,WAAWlB,IAAX,CAAgB,CAAC,EAAE0B,kBAAF,EAAD,KAA4B;AACjD;AACA;AACA;AACA;AACA;AACD,KANM,CAAP;AAOD;;AAEDnC,mBAAiB;AACf,UAAM,EAAEL,OAAF,EAAWyB,UAAX,KAA0B,KAAK/B,GAAL,CAASG,KAAT,CAAeC,KAA/C;AACA,SAAKJ,GAAL,CAASiE,WAAT,CAAqB;AACnB5D,YAAM,UADa;AAEnB6D,aAAO5D,QAAQ4D,KAFI;AAGnBC,eAAS7D,QAAQ6D,OAHE;AAInBC,gBAAU9D,QAAQ8D,QAJC;AAKnBC,iBAAW/D,QAAQ+D;AALA,KAArB;AAOD;;AAEDzD,kBAAgB;AACd,UAAM,EAAEN,OAAF,EAAWyB,UAAX,KAA0B,KAAK/B,GAAL,CAASG,KAAT,CAAeC,KAA/C;AACA;AACA;AACA;AACA;AACA;AACD;AAhPqB;QAAXN,U,GAAAA,U","file":"handlerBot.js","sourcesContent":["import fs from \"fs-extra\";\nimport path from \"path\";\nimport cp from \"child_process\";\nimport { shared_props } from \"./internal\";\nimport CloudinaryUtils from \"../Bot/Helper/CloudinaryUtils\";\n\n// base URL for webhook server\nexport const baseURL = process.env.BASE_URL;\n\nexport const batch_list = {\n  a: \"22 - 27 JULI 2019\",\n  b: \"29 JULI - 3 AGUSTUS 2019\",\n  c: \"5 - 10 AGUSTUS 2019\",\n  d: \"19 - 24 AGUSTUS 2019\",\n  e: \"26 - 03 SEPTEMBER 2019\"\n};\n\nexport const command_prefix = \"/\";\n\nconst destructCommand = chat => {\n  const prefix = chat[0][0];\n  const command = chat[0].slice(1, chat[0].length);\n  const args = chat.slice(1, chat.length).map(item => item.trim());\n\n  console.log({ prefix, command, args });\n  return { prefix, command, args };\n};\n\nconst handleCommand = (features, command) => {\n  const {\n    FEPList,\n    StoreAdvance,\n    Basic,\n    Template,\n    Twibbon,\n    Courses,\n    PosetLattice\n  } = features;\n\n  const commandList = {\n    add: FEPList.add,\n    upd: FEPList.update,\n    rem: FEPList.remove,\n    view: FEPList.view,\n    rstore: StoreAdvance.reset_store,\n    pstore: StoreAdvance.pre_store,\n    bstore: StoreAdvance.backup_store,\n    \"]]\": Basic.admin,\n    help: Basic.help,\n    button: Template.button,\n    profile: Basic.profile,\n    confirm: Template.confirm,\n    bifest: Template.bifest,\n    greet: Basic.greet,\n    say: Basic.say,\n    twibbon: Twibbon.ready,\n    algo: Courses.algo,\n    pl: PosetLattice.generate\n  };\n\n  const {\n    prefix: content_prefix,\n    command: content_command,\n    args: content_args\n  } = destructCommand(command);\n\n  if (Object.keys(commandList).includes(content_command)) {\n    if (commandList[content_command].length >= 1) {\n      commandList[content_command](content_args);\n    } else {\n      commandList[content_command]();\n    }\n  }\n};\n\nconst userQueue = userId => {\n  const queue = {};\n\n  const increment = () => {\n    if (!queue[userId]) {\n      queue[userId] = 0;\n    }\n    queue[userId] += 1;\n  };\n\n  const decrement = () => {\n    if (!queue[userId]) {\n      queue[userId] = 0;\n    }\n    if (queue[userId] >= 1) {\n      queue[userId] -= 1;\n    }\n  };\n\n  return { increment, decrement };\n};\n\nexport class handlerBot {\n  constructor(Bot) {\n    this.Bot = Bot;\n    this.features = Bot.Features;\n    this.eventListener(Bot.props.event);\n  }\n\n  eventListener(event) {\n    console.log(event);\n    // hidden error, need fix\n    // const this.Bot = new Bot({ event });\n    // this.Bot.log()\n\n    // const whitelist = this.Bot.Features.Access.whitelist();\n    // console.log(whitelist);\n    // const type = whitelist.user || whitelist.room ? event.type : null;\n\n    switch (event.type) {\n      case \"message\":\n        const { message } = event;\n        switch (message.type) {\n          case \"text\":\n            return this.handleText();\n          case \"image\":\n            return this.handleImage();\n          case \"video\":\n            return this.handleVideo();\n          case \"audio\":\n            return this.handleAudio();\n          case \"location\":\n            return this.handleLocation();\n          case \"sticker\":\n            return this.handleSticker();\n          default:\n            throw new Error(`Unknown message: ${JSON.stringify(message)}`);\n        }\n\n      case \"memberJoined\":\n        return this.Bot.client\n          .getProfile(event.joined.members[0].userId)\n          .then(profile => {\n            this.Bot.replyText(\n              `Welcome ${profile.displayName}! Jangan lupa cek notes di group ya!`\n            );\n          });\n\n      case \"follow\":\n        return this.Bot.replyText(\"Got followed event\");\n\n      case \"unfollow\":\n        return console.log(`Unfollowed this bot: ${JSON.stringify(event)}`);\n\n      case \"join\":\n        return this.Bot.replyText(`Joined ${event.source.type}`);\n\n      case \"leave\":\n        return console.log(`Left: ${JSON.stringify(event)}`);\n\n      case \"postback\":\n        let { data } = event.postback;\n        if (data === \"DATE\" || data === \"TIME\" || data === \"DATETIME\") {\n          data += `(${JSON.stringify(event.postback.params)})`;\n        }\n\n        const objectData = JSON.parse(data);\n\n        const { Twibbon } = this.Bot.Features;\n        Twibbon.listenPostback(objectData);\n\n        break;\n\n      case \"beacon\":\n        return this.Bot.replyText(`Got beacon: ${event.beacon}`);\n\n      default:\n        throw new Error(`Unknown event: ${JSON.stringify(event)}`);\n    }\n  }\n\n  handleText() {\n    const { message, replyToken, source } = this.Bot.props.event;\n\n    // The text query request.\n    const splittedChat = message.text.split(\" \");\n    const isTextCommand = splittedChat[0][0] === command_prefix;\n    if (isTextCommand) {\n      handleCommand(this.Bot.Features, splittedChat);\n    } else {\n      // hidden error, need fix\n      this.Bot.dialogFlow.listen();\n    }\n  }\n\n  handleImage() {\n    const { message, replyToken } = this.Bot.props.event;\n    let getContent;\n\n    const imageData = {\n      originalPath: path.join(\n        __dirname,\n        \"../../src/Bot/Assets/downloaded/images\",\n        `${message.id}.jpg`\n      ),\n      previewPath: path.join(\n        __dirname,\n        \"../../src/Bot/Assets/downloaded/images\",\n        `${message.id}-preview.jpg`\n      ),\n      originalContentUrl: `${baseURL}/downloaded/images/${message.id}.jpg`,\n      previewImageUrl: `${baseURL}/downloaded/images/${message.id}.jpg`\n    };\n\n    if (message.contentProvider.type === \"line\") {\n      getContent = () => {\n        return this.Bot.downloadContent(message.id)\n          .then(() => {\n            console.log(\"handleImageDownloaded\", imageData.originalPath);\n            cp.execSync(\n              `convert -resize 240x jpg:${imageData.originalPath} jpg:${imageData.previewPath}`\n            );\n            return imageData;\n          })\n          .catch(err => {\n            throw err;\n          });\n      };\n    } else if (message.contentProvider.type === \"external\") {\n      getContent = () => {\n        return Promise.resolve(message.contentProvider);\n      };\n    }\n\n    this.Bot.downloadContent(message.id, imageData.originalPath).then(() => {\n      const url = `${baseURL}/downloaded/images/${path.basename(\n        imageData.originalPath\n      )}`;\n      CloudinaryUtils.upload(url, message.id).then(fileMeta => {\n        fs.unlinkSync(imageData.originalPath);\n      });\n    });\n\n    // Twibbon switch\n    const { Twibbon } = this.Bot.Features;\n    Twibbon.listenImage(getContent);\n  }\n\n  handleVideo() {\n    const { message, replyToken } = this.Bot.props.event;\n    let getContent;\n    if (message.contentProvider.type === \"line\") {\n      const downloadPath = path.join(\n        __dirname,\n        \"../../src/Bot/Assets/downloaded/videos\",\n        `${message.id}.mp4`\n      );\n      const previewPath = path.join(\n        __dirname,\n        \"../../src/Bot/Assets/downloaded/videos\",\n        `${message.id}-preview.jpg`\n      );\n\n      getContent = this.Bot.downloadContent(message.id, downloadPath).then(\n        downloadPath => {\n          // FFmpeg and ImageMagick is needed here to run 'convert'\n          // Please consider about security and performance by yourself\n          cp.execSync(`convert mp4:${downloadPath}[0] jpeg:${previewPath}`);\n\n          return {\n            originalContentUrl: `${baseURL}/downloaded/videos/${path.basename(\n              downloadPath\n            )}`,\n            previewImageUrl: `${baseURL}/downloaded/videos/${path.basename(\n              previewPath\n            )}`\n          };\n        }\n      );\n    } else if (message.contentProvider.type === \"external\") {\n      getContent = Promise.resolve(message.contentProvider);\n    }\n\n    return getContent.then(({ originalContentUrl, previewImageUrl }) => {\n      // this.Bot.sendMessage({\n      //   type: \"video\",\n      //   originalContentUrl,\n      //   previewImageUrl\n      // });\n    });\n  }\n\n  handleAudio() {\n    const { message, replyToken } = this.Bot.props.event;\n    let getContent;\n    if (message.contentProvider.type === \"line\") {\n      const downloadPath = path.join(\n        __dirname,\n        \"../../src/Bot/Assets/downloaded/audios\",\n        `${message.id}.m4a`\n      );\n\n      getContent = this.Bot.downloadContent(message.id, downloadPath).then(\n        downloadPath => {\n          return {\n            originalContentUrl: `${baseURL}/downloaded/audios/${path.basename(\n              downloadPath\n            )}`\n          };\n        }\n      );\n    } else {\n      getContent = Promise.resolve(message.contentProvider);\n    }\n\n    return getContent.then(({ originalContentUrl }) => {\n      // this.Bot.sendMessage({\n      //   type: \"audio\",\n      //   originalContentUrl,\n      //   duration: message.duration\n      // });\n    });\n  }\n\n  handleLocation() {\n    const { message, replyToken } = this.Bot.props.event;\n    this.Bot.sendMessage({\n      type: \"location\",\n      title: message.title,\n      address: message.address,\n      latitude: message.latitude,\n      longitude: message.longitude\n    });\n  }\n\n  handleSticker() {\n    const { message, replyToken } = this.Bot.props.event;\n    // this.Bot.sendMessage({\n    //   type: \"sticker\",\n    //   packageId: message.packageId,\n    //   stickerId: message.stickerId\n    // });\n  }\n}\n"]}