{"version":3,"sources":["../src/app.js"],"names":["line","cloudinary","config","cloudinaryConfig","Store","init","app","disable","set","path","join","__dirname","use","skip","get","express","static","middleware","lineConfig","bodyParser","json","urlencoded","extended","routes","err","req","res","next","SignatureValidationFailed","status","send","signature","JSONParseError","raw","Error","render","message"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;IAAYA,I;;AACZ;;;;AACA;;;;AAIA;;;;;;;;AAFAC,qBAAWC,MAAX,CAAkBC,oBAAlB;;AAIAC,gBAAMC,IAAN;;AAEA,MAAMC,MAAM,wBAAZ;;AAEAA,IAAIC,OAAJ,CAAY,cAAZ;;AAEA;AACAD,IAAIE,GAAJ,CAAQ,OAAR,EAAiBC,eAAKC,IAAL,CAAUC,SAAV,EAAqB,UAArB,CAAjB;AACAL,IAAIE,GAAJ,CAAQ,aAAR,EAAuB,KAAvB;;AAEAF,IAAIM,GAAJ,CAAQ,sBAAO,KAAP,EAAc;AACpBC,QAAM,MAAMP,IAAIQ,GAAJ,CAAQ,KAAR,MAAmB;AADX,CAAd,CAAR;;AAIA;AACAR,IAAIM,GAAJ,CAAQ,SAAR,EAAmBG,kBAAQC,MAAR,CAAeP,eAAKC,IAAL,CAAUC,SAAV,EAAqB,kBAArB,CAAf,CAAnB;AACAL,IAAIM,GAAJ,CAAQ,aAAR,EAAuBG,kBAAQC,MAAR,CAAeP,eAAKC,IAAL,CAAUC,SAAV,EAAqB,sBAArB,CAAf,CAAvB;AACAL,IAAIM,GAAJ,CAAQ,WAAR,EAAqBG,kBAAQC,MAAR,CAAeP,eAAKC,IAAL,CAAUC,SAAV,EAAqB,oBAArB,CAAf,CAArB;;AAEAL,IAAIM,GAAJ,CAAQ,UAAR,EAAoBZ,KAAKiB,UAAL,CAAgBC,cAAhB,CAApB;;AAEAZ,IAAIM,GAAJ,CAAQO,qBAAWC,IAAX,EAAR;AACAd,IAAIM,GAAJ,CAAQO,qBAAWE,UAAX,CAAsB;AAC5BC,YAAU;AADkB,CAAtB,CAAR;AAGAhB,IAAIM,GAAJ,CAAQG,kBAAQC,MAAR,CAAeP,eAAKC,IAAL,CAAUC,SAAV,EAAqB,WAArB,CAAf,CAAR;;AAEA;AACAL,IAAIM,GAAJ,CAAQ,GAAR,EAAaW,gBAAb;;AAEAjB,IAAIM,GAAJ,CAAQ,CAACY,GAAD,EAAMC,GAAN,EAAWC,GAAX,EAAgBC,IAAhB,KAAyB;AAC/B,MAAIH,eAAexB,KAAK4B,yBAAxB,EAAmD;AACjDF,QAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBN,IAAIO,SAAzB;AACA;AACD,GAHD,MAGO,IAAIP,eAAexB,KAAKgC,cAAxB,EAAwC;AAC7CN,QAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBN,IAAIS,GAAzB;AACA;AACD;AACDN,OAAKH,GAAL,EAR+B,CAQpB;AACZ,CATD;;AAWA;AACAlB,IAAIM,GAAJ,CAAQ,CAACa,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AAC1B,QAAMH,MAAM,IAAIU,KAAJ,CAAU,WAAV,CAAZ;AACAV,MAAIK,MAAJ,GAAa,GAAb;AACAF,OAAKH,GAAL;AACD,CAJD;;AAMA;AACAlB,IAAIM,GAAJ,CAAQ,CAACY,GAAD,EAAMC,GAAN,EAAWC,GAAX,EAAgBC,IAAhB,KAAyB;AAC/BD,MAAIG,MAAJ,CAAWL,IAAIK,MAAJ,IAAc,GAAzB,EAA8BM,MAA9B,CAAqC,OAArC,EAA8C;AAC5CC,aAASZ,IAAIY;AAD+B,GAA9C;AAGD,CAJD;;AAOA;AACA;AACA;AACA;AACA;;;kBAGe9B,G","file":"app.js","sourcesContent":["import express from \"express\";\nimport path from \"path\";\nimport logger from \"morgan\";\nimport bodyParser from \"body-parser\";\nimport routes from \"./routes\";\nimport cloudinary from \"cloudinary\";\n\nimport * as line from \"@line/bot-sdk\";\nimport lineConfig from \"./Config/Line\";\nimport cloudinaryConfig from \"./Config/Cloudinary\";\n\ncloudinary.config(cloudinaryConfig);\n\nimport Store from \"./Services/Store\";\n\nStore.init();\n\nconst app = express();\n\napp.disable(\"x-powered-by\");\n\n// View engine setup\napp.set(\"views\", path.join(__dirname, \"../views\"));\napp.set(\"view engine\", \"pug\");\n\napp.use(logger(\"dev\", {\n  skip: () => app.get(\"env\") === \"test\"\n}));\n\n// serve static and downloaded files\napp.use(\"/static\", express.static(path.join(__dirname, \"../assets/static\")));\napp.use(\"/downloaded\", express.static(path.join(__dirname, \"../assets/downloaded\")));\napp.use(\"/twibbons\", express.static(path.join(__dirname, \"../assets/twibbons\")));\n\napp.use(\"/webhook\", line.middleware(lineConfig));\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({\n  extended: false\n}));\napp.use(express.static(path.join(__dirname, \"../public\")));\n\n//  Routes\napp.use(\"/\", routes);\n\napp.use((err, req, res, next) => {\n  if (err instanceof line.SignatureValidationFailed) {\n    res.status(401).send(err.signature);\n    return;\n  } else if (err instanceof line.JSONParseError) {\n    res.status(400).send(err.raw);\n    return;\n  }\n  next(err); // will throw default 500\n});\n\n// Catch 404 and forward to error handler\napp.use((req, res, next) => {\n  const err = new Error(\"Not Found\");\n  err.status = 404;\n  next(err);\n});\n\n// Error handler\napp.use((err, req, res, next) => {\n  res.status(err.status || 500).render(\"error\", {\n    message: err.message\n  });\n});\n\n\n// Debug\n// app.use((err, req, res, next) => {\n//   console.log(`REQ ${req}`);\n//   console.log(`RES ${res}`);\n// });\n\n\nexport default app;"]}