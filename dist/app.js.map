{"version":3,"sources":["../src/app.js"],"names":["line","cloudinary","config","cloud_name","api_key","api_secret","Store","init","app","disable","set","path","join","__dirname","use","skip","get","express","static","middleware","bodyParser","json","urlencoded","extended","routes","err","req","res","next","SignatureValidationFailed","status","send","signature","JSONParseError","raw","Error","render","message"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAQA;;IAAYA,I;;AAEZ;;;;AAEA;;;;;;;;AAVAC,qBAAWC,MAAX,CAAkB;AAChBC,cAAY,SADI;AAEhBC,WAAS,SAFO;AAGhBC,cAAY;AAHI,CAAlB;;AAYAC,gBAAMC,IAAN;;AAEA,MAAMC,MAAM,wBAAZ;;AAEAA,IAAIC,OAAJ,CAAY,cAAZ;;AAEA;AACAD,IAAIE,GAAJ,CAAQ,OAAR,EAAiBC,eAAKC,IAAL,CAAUC,SAAV,EAAqB,UAArB,CAAjB;AACAL,IAAIE,GAAJ,CAAQ,aAAR,EAAuB,KAAvB;;AAEAF,IAAIM,GAAJ,CACE,sBAAO,KAAP,EAAc;AACZC,QAAM,MAAMP,IAAIQ,GAAJ,CAAQ,KAAR,MAAmB;AADnB,CAAd,CADF;;AAMA;AACAR,IAAIM,GAAJ,CACE,SADF,EAEEG,kBAAQC,MAAR,CAAeP,eAAKC,IAAL,CAAUC,SAAV,EAAqB,0BAArB,CAAf,CAFF;AAIAL,IAAIM,GAAJ,CACE,aADF,EAEEG,kBAAQC,MAAR,CAAeP,eAAKC,IAAL,CAAUC,SAAV,EAAqB,8BAArB,CAAf,CAFF;;AAKAL,IAAIM,GAAJ,CAAQ,UAAR,EAAoBd,KAAKmB,UAAL,CAAgBjB,cAAhB,CAApB;;AAEAM,IAAIM,GAAJ,CAAQM,qBAAWC,IAAX,EAAR;AACAb,IAAIM,GAAJ,CAAQM,qBAAWE,UAAX,CAAsB,EAAEC,UAAU,KAAZ,EAAtB,CAAR;AACAf,IAAIM,GAAJ,CAAQG,kBAAQC,MAAR,CAAeP,eAAKC,IAAL,CAAUC,SAAV,EAAqB,WAArB,CAAf,CAAR;;AAEA;AACAL,IAAIM,GAAJ,CAAQ,GAAR,EAAaU,gBAAb;;AAEAhB,IAAIM,GAAJ,CAAQ,CAACW,GAAD,EAAMC,GAAN,EAAWC,GAAX,EAAgBC,IAAhB,KAAyB;AAC/B,MAAIH,eAAezB,KAAK6B,yBAAxB,EAAmD;AACjDF,QAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBN,IAAIO,SAAzB;AACA;AACD,GAHD,MAGO,IAAIP,eAAezB,KAAKiC,cAAxB,EAAwC;AAC7CN,QAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBN,IAAIS,GAAzB;AACA;AACD;AACDN,OAAKH,GAAL,EAR+B,CAQpB;AACZ,CATD;;AAWA;AACAjB,IAAIM,GAAJ,CAAQ,CAACY,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AAC1B,QAAMH,MAAM,IAAIU,KAAJ,CAAU,WAAV,CAAZ;AACAV,MAAIK,MAAJ,GAAa,GAAb;AACAF,OAAKH,GAAL;AACD,CAJD;;AAMA;AACAjB,IAAIM,GAAJ,CAAQ,CAACW,GAAD,EAAMC,GAAN,EAAWC,GAAX,EAAgBC,IAAhB,KAAyB;AAC/B;AACAD,MAAIG,MAAJ,CAAWL,IAAIK,MAAJ,IAAc,GAAzB,EAA8BM,MAA9B,CAAqC,OAArC,EAA8C;AAC5CC,aAASZ,IAAIY;AAD+B,GAA9C;AAGD,CALD;;kBAOe7B,G","file":"app.js","sourcesContent":["import express from \"express\";\nimport path from \"path\";\nimport logger from \"morgan\";\nimport bodyParser from \"body-parser\";\nimport routes from \"./routes\";\nimport cloudinary from \"cloudinary\";\n\ncloudinary.config({\n  cloud_name: \"fep-bot\",\n  api_key: \"fep-bot\",\n  api_secret: \"_R0PRhWo1KuScAycGwbmodqtsts\"\n});\n\nimport * as line from \"@line/bot-sdk\";\n\nimport config from \"./Config/Line\";\n\nimport Store from \"./Services/Store\";\n\nStore.init();\n\nconst app = express();\n\napp.disable(\"x-powered-by\");\n\n// View engine setup\napp.set(\"views\", path.join(__dirname, \"../views\"));\napp.set(\"view engine\", \"pug\");\n\napp.use(\n  logger(\"dev\", {\n    skip: () => app.get(\"env\") === \"test\"\n  })\n);\n\n// serve static and downloaded files\napp.use(\n  \"/static\",\n  express.static(path.join(__dirname, \"../src/Bot/Assets/static\"))\n);\napp.use(\n  \"/downloaded\",\n  express.static(path.join(__dirname, \"../src/Bot/Assets/downloaded\"))\n);\n\napp.use(\"/webhook\", line.middleware(config));\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(express.static(path.join(__dirname, \"../public\")));\n\n// // Routes\napp.use(\"/\", routes);\n\napp.use((err, req, res, next) => {\n  if (err instanceof line.SignatureValidationFailed) {\n    res.status(401).send(err.signature);\n    return;\n  } else if (err instanceof line.JSONParseError) {\n    res.status(400).send(err.raw);\n    return;\n  }\n  next(err); // will throw default 500\n});\n\n// Catch 404 and forward to error handler\napp.use((req, res, next) => {\n  const err = new Error(\"Not Found\");\n  err.status = 404;\n  next(err);\n});\n\n// Error handler\napp.use((err, req, res, next) => {\n  // eslint-disable-line no-unused-vars\n  res.status(err.status || 500).render(\"error\", {\n    message: err.message\n  });\n});\n\nexport default app;\n"]}