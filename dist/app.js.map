{"version":3,"sources":["../src/app.js"],"names":["line","cloudinary","config","cloudinaryConfig","Store","init","app","disable","set","path","join","__dirname","use","skip","get","express","static","middleware","lineConfig","bodyParser","json","urlencoded","extended","routes","err","req","res","next","SignatureValidationFailed","status","send","signature","JSONParseError","raw","Error","render","message"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;IAAYA,I;;AACZ;;;;AACA;;;;AACA;;;;AAEA;;;;;;;;AAEAC,qBAAWC,MAAX,CAAkBC,oBAAlB;;AAEAC,gBAAMC,IAAN;;AAEA,MAAMC,MAAM,wBAAZ;;AAEAA,IAAIC,OAAJ,CAAY,cAAZ;;AAEA;AACAD,IAAIE,GAAJ,CAAQ,OAAR,EAAiBC,eAAKC,IAAL,CAAUC,SAAV,EAAqB,UAArB,CAAjB;AACAL,IAAIE,GAAJ,CAAQ,aAAR,EAAuB,KAAvB;;AAEAF,IAAIM,GAAJ,CACE,sBAAO,KAAP,EAAc;AACZC,QAAM,MAAMP,IAAIQ,GAAJ,CAAQ,KAAR,MAAmB;AADnB,CAAd,CADF;;AAMA;AACAR,IAAIM,GAAJ,CAAQ,SAAR,EAAmBG,kBAAQC,MAAR,CAAeP,eAAKC,IAAL,CAAUC,SAAV,EAAqB,kBAArB,CAAf,CAAnB;AACAL,IAAIM,GAAJ,CACE,aADF,EAEEG,kBAAQC,MAAR,CAAeP,eAAKC,IAAL,CAAUC,SAAV,EAAqB,sBAArB,CAAf,CAFF;AAIAL,IAAIM,GAAJ,CACE,WADF,EAEEG,kBAAQC,MAAR,CAAeP,eAAKC,IAAL,CAAUC,SAAV,EAAqB,oBAArB,CAAf,CAFF;;AAKAL,IAAIM,GAAJ,CAAQ,UAAR,EAAoBZ,KAAKiB,UAAL,CAAgBC,cAAhB,CAApB;;AAEAZ,IAAIM,GAAJ,CAAQO,qBAAWC,IAAX,EAAR;AACAd,IAAIM,GAAJ,CACEO,qBAAWE,UAAX,CAAsB;AACpBC,YAAU;AADU,CAAtB,CADF;AAKAhB,IAAIM,GAAJ,CAAQG,kBAAQC,MAAR,CAAeP,eAAKC,IAAL,CAAUC,SAAV,EAAqB,WAArB,CAAf,CAAR;;AAEA;AACAL,IAAIM,GAAJ,CAAQ,GAAR,EAAaW,gBAAb;;AAEAjB,IAAIM,GAAJ,CAAQ,CAACY,GAAD,EAAMC,GAAN,EAAWC,GAAX,EAAgBC,IAAhB,KAAyB;AAC/B,MAAIH,eAAexB,KAAK4B,yBAAxB,EAAmD;AACjDF,QAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBN,IAAIO,SAAzB;AACA;AACD;AACD,MAAIP,eAAexB,KAAKgC,cAAxB,EAAwC;AACtCN,QAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBN,IAAIS,GAAzB;AACA;AACD;AACDN,OAAKH,GAAL,EAT+B,CASpB;AACZ,CAVD;;AAYA;AACAlB,IAAIM,GAAJ,CAAQ,CAACa,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AAC1B,QAAMH,MAAM,IAAIU,KAAJ,CAAU,WAAV,CAAZ;AACAV,MAAIK,MAAJ,GAAa,GAAb;AACAF,OAAKH,GAAL;AACD,CAJD;;AAMA;AACAlB,IAAIM,GAAJ,CAAQ,CAACY,GAAD,EAAMC,GAAN,EAAWC,GAAX,EAAgBC,IAAhB,KAAyB;AAC/BD,MAAIG,MAAJ,CAAWL,IAAIK,MAAJ,IAAc,GAAzB,EAA8BM,MAA9B,CAAqC,OAArC,EAA8C;AAC5CC,aAASZ,IAAIY;AAD+B,GAA9C;AAGD,CAJD;;AAMA;AACA;AACA;AACA;AACA;;kBAEe9B,G","file":"app.js","sourcesContent":["import express from \"express\";\nimport path from \"path\";\nimport logger from \"morgan\";\nimport bodyParser from \"body-parser\";\nimport cloudinary from \"cloudinary\";\n\nimport * as line from \"@line/bot-sdk\";\nimport routes from \"./routes\";\nimport lineConfig from \"./Config/Line\";\nimport cloudinaryConfig from \"./Config/Cloudinary\";\n\nimport Store from \"./Services/Store\";\n\ncloudinary.config(cloudinaryConfig);\n\nStore.init();\n\nconst app = express();\n\napp.disable(\"x-powered-by\");\n\n// View engine setup\napp.set(\"views\", path.join(__dirname, \"../views\"));\napp.set(\"view engine\", \"pug\");\n\napp.use(\n  logger(\"dev\", {\n    skip: () => app.get(\"env\") === \"test\",\n  })\n);\n\n// serve static and downloaded files\napp.use(\"/static\", express.static(path.join(__dirname, \"../assets/static\")));\napp.use(\n  \"/downloaded\",\n  express.static(path.join(__dirname, \"../assets/downloaded\"))\n);\napp.use(\n  \"/twibbons\",\n  express.static(path.join(__dirname, \"../assets/twibbons\"))\n);\n\napp.use(\"/webhook\", line.middleware(lineConfig));\n\napp.use(bodyParser.json());\napp.use(\n  bodyParser.urlencoded({\n    extended: false,\n  })\n);\napp.use(express.static(path.join(__dirname, \"../public\")));\n\n//  Routes\napp.use(\"/\", routes);\n\napp.use((err, req, res, next) => {\n  if (err instanceof line.SignatureValidationFailed) {\n    res.status(401).send(err.signature);\n    return;\n  }\n  if (err instanceof line.JSONParseError) {\n    res.status(400).send(err.raw);\n    return;\n  }\n  next(err); // will throw default 500\n});\n\n// Catch 404 and forward to error handler\napp.use((req, res, next) => {\n  const err = new Error(\"Not Found\");\n  err.status = 404;\n  next(err);\n});\n\n// Error handler\napp.use((err, req, res, next) => {\n  res.status(err.status || 500).render(\"error\", {\n    message: err.message,\n  });\n});\n\n// Debug\n// app.use((err, req, res, next) => {\n//   console.log(`REQ ${req}`);\n//   console.log(`RES ${res}`);\n// });\n\nexport default app;\n"]}