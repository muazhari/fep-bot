{"version":3,"sources":["../src/routes.js"],"names":["line","routes","post","req","res","t0","Date","console","log","body","destination","Array","isArray","events","status","end","Promise","all","map","event","Bot","then","result","json","catch","err","finally","t1","tDelta","getTime","get","render","title","next","query","Error"],"mappings":";;;;;;AAAA;;AACA;;;;AACA;;IAAYA,I;;AAEZ;;;;;;AAEA,MAAMC,SAAS,sBAAf;;AAEA;;;;AAIA;AACA;AACAA,OAAOC,IAAP,CAAY,UAAZ,EAAwB,CAACC,GAAD,EAAMC,GAAN,KAAc;AACpC,QAAMC,KAAK,IAAIC,IAAJ,EAAX;AACAC,UAAQC,GAAR,CAAa,0CAAyCH,EAAG,EAAzD;;AAEA,MAAIF,IAAIM,IAAJ,CAASC,WAAb,EAA0B;AACxBH,YAAQC,GAAR,CAAY,uBAAZ,EAAqCL,IAAIM,IAAJ,CAASC,WAA9C;AACD;;AAED;AACA,MAAI,CAACC,MAAMC,OAAN,CAAcT,IAAIM,IAAJ,CAASI,MAAvB,CAAL,EAAqC;AACnC,WAAOT,IAAIU,MAAJ,CAAW,GAAX,EAAgBC,GAAhB,EAAP;AACD;;AAED;AACAC,UAAQC,GAAR,CACEd,IAAIM,IAAJ,CAASI,MAAT,CAAgBK,GAAhB,CAAoBC,SAAS;AAC3B,QAAIC,QAAJ,CAAQ;AACND;AADM,KAAR;AAGD,GAJD,CADF,EAOGE,IAPH,CAOQC,UAAUlB,IAAImB,IAAJ,CAASD,MAAT,CAPlB,EAQGE,KARH,CAQSC,OAAO;AACZlB,YAAQC,GAAR,CAAa,4BAA2BiB,GAAI,EAA5C;AACArB,QAAIU,MAAJ,CAAW,GAAX,EAAgBC,GAAhB;AACA,UAAMU,GAAN;AACD,GAZH,EAaGC,OAbH,CAaW,MAAM;AACb,UAAMC,KAAK,IAAIrB,IAAJ,EAAX;AACA,UAAMsB,SAASD,GAAGE,OAAH,KAAexB,GAAGwB,OAAH,EAA9B;AACAtB,YAAQC,GAAR,CACG,iDAAgDH,EAAG,OAAMsB,EAAG,OAAMC,MAAO,IAD5E;AAGD,GAnBH;AAoBD,CAlCD;;AAoCA;;;AAGA3B,OAAO6B,GAAP,CAAW,GAAX,EAAgB,CAAC3B,GAAD,EAAMC,GAAN,KAAc;AAC5BA,MAAI2B,MAAJ,CAAW,OAAX,EAAoB;AAClBC,WAAO;AADW,GAApB;AAGD,CAJD;;AAMA;;;;;;;;;AASA/B,OAAO6B,GAAP,CAAW,OAAX,EAAoB,CAAC3B,GAAD,EAAMC,GAAN,EAAW6B,IAAX,KAAoB;AACtC,QAAM,EAAED,KAAF,KAAY7B,IAAI+B,KAAtB;;AAEA,MAAIF,SAAS,IAAT,IAAiBA,UAAU,EAA/B,EAAmC;AACjC;AACA;AACA;AACA;AACAC,SAAK,IAAIE,KAAJ,CAAU,mCAAV,CAAL;AACA;AACD;;AAED/B,MAAI2B,MAAJ,CAAW,OAAX,EAAoB;AAClBC;AADkB,GAApB;AAGD,CAfD;;kBAiBe/B,M","file":"routes.js","sourcesContent":["import { Router } from \"express\";\nimport axios from \"axios\";\nimport * as line from \"@line/bot-sdk\";\n\nimport { Bot } from \"./Bot\";\n\nconst routes = Router();\n\n/**\n * Bot Webhook\n */\n\n// register a webhook handler with middleware\n// about the middleware, please refer to doc\nroutes.post(\"/webhook\", (req, res) => {\n  const t0 = new Date();\n  console.log(`[ROUTES] /webhook transmission at time ${t0}`);\n\n  if (req.body.destination) {\n    console.log(\"Destination User ID: \", req.body.destination);\n  }\n\n  // req.body.events should be an array of events\n  if (!Array.isArray(req.body.events)) {\n    return res.status(500).end();\n  }\n\n  //handle events separately\n  Promise.all(\n    req.body.events.map(event => {\n      new Bot({\n        event\n      });\n    })\n  )\n    .then(result => res.json(result))\n    .catch(err => {\n      console.log(`[ROUTES] /webhook ERROR: ${err}`);\n      res.status(500).end();\n      throw err;\n    })\n    .finally(() => {\n      const t1 = new Date();\n      const tDelta = t1.getTime() - t0.getTime();\n      console.log(\n        `[ROUTES] /webhook transmission done from time ${t0} to ${t1} in ${tDelta}ms`\n      );\n    });\n});\n\n/**\n * GET home page\n */\nroutes.get(\"/\", (req, res) => {\n  res.render(\"index\", {\n    title: \"fep-bot splash web yeah!\"\n  });\n});\n\n/**\n * GET /list\n *\n * This is a sample route demonstrating\n * a simple approach to error handling and testing\n * the global error handler. You most certainly want to\n * create different/better error handlers depending on\n * your use case.\n */\nroutes.get(\"/list\", (req, res, next) => {\n  const { title } = req.query;\n\n  if (title == null || title === \"\") {\n    // You probably want to set the response HTTP status to 400 Bad Request\n    // or 422 Unprocessable Entity instead of the default 500 of\n    // the global error handler (e.g check out https://github.com/kbariotis/throw.js).\n    // This is just for demo purposes.\n    next(new Error('The \"title\" parameter is required'));\n    return;\n  }\n\n  res.render(\"index\", {\n    title\n  });\n});\n\nexport default routes;\n"]}
